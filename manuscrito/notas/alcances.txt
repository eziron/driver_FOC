// lo siguiente es contexto de las demás validaciones para referencia del formato

\chapter{Validación}
Para las validaciones, se realizó una adquisición de datos, donde estos se recopilan ciclo a ciclo en la memoria RAM del microcontrolador para su posterior envío de forma asincrónica por el puerto USB, como se muestra en la figura \ref{flujo_debug}. Los datos son recibidos en una computadora a través de un código en Python, donde se almacenan en archivos CSV. Esta recopilación de información se realiza al final de cada ejecución de la interrupción del sistema, la cual se ejecuta a una frecuencia de 48 kHz. Debido a las limitaciones de memoria, la recopilación de datos solo puede llevarse a cabo durante un período de aproximadamente 100 ms, hasta alcanzar la capacidad máxima de la memoria.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Debug USB.png}
	\caption{Diagrama de flujo adquisición de datos.}
	\label{flujo_debug}
\end{figure}
\FloatBarrier

\section{Validación de la adquisición y transformación de las mediciones de corriente}

\subsection{Validación de las mediciones de corriente}
Se validaran las mediciones de corriente adquiridas desde el microcontrolador.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_ABC_ideal.png}
	\caption{Corrientes ideales en un sistema trifásico equilibrado.}
	\label{corrientes_ABC_ideal}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_ABC_ideal} se representan las señales ideales de un sistema trifásico equilibrado, con las tres corrientes de fase $I_a$, $I_b$ e $I_c$, cada una de ellas con una forma senoidal pura y un desfase de $120^\circ$ entre sí.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_ABC.png}
	\caption{Corrientes medidas en el sistema trifásico.}
	\label{corrientes_ABC}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_ABC} se pueden apreciar las corrientes de fase, las cuales presentan una cantidad significativa de ruido, aun cuando internamente pasan por un filtro complementario con una frecuencia de corte $f_W=12000Hz$, pero mantienen un comportamiento sinusoidal con el desfase de $120^\circ$ entre señales, como es característico de un sistema trifásico equilibrado. pero la cantidad de ruido podría indicar que seria necesario disminuir la frecuencia de corte en el filtro complementario o agregar un filtro pasivo en el circuito.

\newpage
\subsection{Validación de la transformada de Clarke}

Se validara los resultado a la salida de la transformada de Clarke en el microcontrolador.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_AlphaBeta_ideal.png}
	\caption{Corrientes ideales en el plano $\alpha\beta$.}
	\label{corrientes_alpha_beta_ideal}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_alpha_beta_ideal} se representan las corrientes ideales en el plano $\alpha\beta$, con las formas senoidales puras con un desfase de $90^\circ$ entre sí.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_AlphaBeta.png}
	\caption{Corrientes medidas en el plano $\alpha\beta$.}
	\label{corrientes_alpha_beta}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_alpha_beta} se pueden apreciar como las corrientes $\alpha\beta$ reflejan el ruido presente en las mediciones de los sensores de corriente, pero mantienen un comportamiento esperado a la salida de la transformada de Clarke con las dos señales sinusoidal con el desfase de $90^\circ$ entre señales, como es característico.

\newpage
\subsection{Validación de la transformada de Park}

Se validara los resultado a la salida de la transformada de Park en el microcontrolador.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_dq_ideal.png}
	\caption{Corrientes ideales en el plano $dq$.}
	\label{corrientes_dq_ideal}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_dq_ideal} se representan las corrientes ideales en el plano $dq$, donde lo ideal, es que la corriente directa tenga un valor de cero, para mantener la eficiencia del sistema, mientras que solo la corriente de cuadratura tiene un valor distinto a cero.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{imagenes/Corrientes_dq.png}
	\caption{Corrientes medidas en el plano $dq$.}
	\label{corrientes_dq}
\end{figure}
\FloatBarrier

En la figura \ref{corrientes_dq} se pueden apreciar como las corrientes $dq$ presenta una menor cantidad de ruido gracias a que su filtro complementario esta ajustado para una frecuencia de corte de $f_W=800Hz$, aunque igualmente presentan ciertas deformaciones y e inestabilidad con un patron aparentemente constante, pero en términos generales mantienen aproximadamente el comportamiento esperado a la salida de la transformada de Park.


//lo siguiente es un análisis de las graficas obtenidas de los controladores PI de mi implementación de controlador FOC

### Gráfico 1: Velocidad (RPM) - Controlador de Velocidad
#### Descripción Visual:
- **Línea roja (SetPoint)**: Está en un valor constante de **116.9 RPM**. Representa el objetivo de velocidad que el controlador debe mantener.
- **Línea azul (Encoder)**: Representa la velocidad medida en tiempo real por el encoder. Se observa que la velocidad inicialmente tiene un valor menor, luego aumenta de manera rápida hasta estabilizarse alrededor del setpoint, aunque con oscilaciones constantes.

#### Interpretación:
- **Estabilidad**: La velocidad medida (azul) en su mayor parte oscila cerca del valor de referencia (116.9 RPM). Sin embargo, hay variaciones y fluctuaciones alrededor del setpoint, lo que indica la presencia de algunas inestabilidades o ruido en el sistema de control de velocidad. Esto podría ser debido a varias razones: ruido en la medición del encoder, características del controlador PI, o la no linealidad del motor.
- **Tendencias**: La velocidad comienza con una diferencia significativa respecto al setpoint, lo que sugiere un arranque rápido que el controlador intenta corregir. Después de este período de ajuste, la respuesta estabiliza en torno al setpoint, aunque sigue fluctuando ligeramente.

#### Conclusión:
El controlador de velocidad parece estar funcionando correctamente, ya que el sistema alcanza el setpoint en un tiempo razonable. Sin embargo, las oscilaciones podrían reducirse ajustando los parámetros del controlador PI, mejorando la medición o empleando técnicas de filtrado. Estas oscilaciones deben analizarse más para entender si están dentro de los márgenes aceptables para el proyecto.

---

### Gráfico 2: Corriente - Controlador de Corriente
#### Descripción Visual:
- **Línea roja (Setpoint Iq)**: Setpoint de la corriente de cuadratura, la cual es determinada por el controlador de velocidad. El valor se mantiene relativamente estable y cercano a **1 A**.
- **Línea azul (Iq)**: La corriente medida de cuadratura sigue la referencia con variaciones menores pero con tendencia a permanecer en valores cercanos a 1 A. 
- **Línea amarilla (Id)**: Corriente directa, cuyo setpoint es 0 A, y que en la gráfica efectivamente se mantiene cercana a ese valor, con fluctuaciones muy pequeñas alrededor de 0.

#### Interpretación:
- **Estabilidad**: El setpoint de corriente de cuadratura es seguido de cerca por la medición de Iq, lo cual es un buen indicativo del correcto funcionamiento del controlador de corriente. Aunque hay ligeras fluctuaciones, parecen estar dentro de un rango esperado para este tipo de sistemas, debido a ruidos de conmutación, cambios de carga, o dinámica del motor.
- **Comportamiento de la Corriente Directa (Id)**: La corriente Id se mantiene alrededor de 0 A, lo cual es ideal y esperado, ya que el setpoint para Id es 0 en control FOC. Esto sugiere que no hay componentes innecesarios de corriente en el eje directo, lo cual es una señal de buen control vectorial.

#### Conclusión:
El controlador de corriente muestra una respuesta adecuada, con seguimiento preciso de los setpoints tanto para Iq como para Id. Las pequeñas variaciones de Iq y la estabilidad de Id indican que el sistema está funcionando como se espera. El controlador PI de corriente parece estar correctamente ajustado.

---

### Gráfico 3: Salidas de Tensión - Controlador de Corriente
#### Descripción Visual:
- **Línea azul (Vq)**: Tensión de cuadratura, que varía en un rango que va desde aproximadamente 0.35 V hasta 0.5 V. 
- **Línea roja (Vd)**: Tensión directa, que se mantiene cercana a 0 V con pequeñas fluctuaciones negativas, alrededor de -0.05 V.

#### Interpretación:
- **Tensión de cuadratura (Vq)**: Las variaciones en la tensión de cuadratura reflejan los esfuerzos del controlador de corriente para ajustar la corriente Iq y, por lo tanto, mantener el control de la velocidad del motor. El hecho de que la tensión no sea constante indica que el sistema está continuamente ajustándose para corregir errores en la corriente.
- **Tensión directa (Vd)**: La tensión directa, aunque no perfectamente cero, está lo suficientemente cercana a 0 V, lo cual es deseable ya que el setpoint para Id es 0 A. Esto sugiere que el controlador está logrando mantener la corriente Id mínima, y el control vectorial está en su lugar.

#### Conclusión:
Las tensiones Vq y Vd están funcionando como indicadores de la acción de los controladores de corriente, con una adecuada compensación de errores en las corrientes de cuadratura y directa. La fluctuación de Vq muestra un control dinámico en respuesta a cambios en la demanda de torque.

---

### Conclusión Global:
Con base en las tres gráficas presentadas, se puede decir que el sistema de control FOC está funcionando de manera razonablemente correcta. Tanto los controladores de corriente como el de velocidad parecen estar siguiendo sus setpoints con niveles aceptables de precisión, aunque hay margen de mejora, sobre todo en la reducción de las oscilaciones en la respuesta de velocidad.

Algunos puntos a considerar para afinar tu validación:
- **Ajuste de los parámetros PI**: En el controlador de velocidad, podrías explorar mejoras en el ajuste del PI para reducir las oscilaciones que se observan en la velocidad.
- **Filtrado de señales**: Si las variaciones observadas en las señales se deben a ruido del encoder o variabilidad en la medición de corriente, podrías aplicar algún filtrado para reducir este efecto.
- **Margen de error**: Determinar si las pequeñas oscilaciones que se observan están dentro de un rango tolerable para los objetivos de tu proyecto. Si es así, tu validación estaría correcta tal como está.

Estas gráficas pueden ser una pieza clave en tu validación, y los análisis presentados podrían formar parte de tu defensa, mostrando el correcto funcionamiento del control de motores brushless con FOC.

//lo siguiente es el código latex de mi proyecto de titulo dedicado a la validación del funcionamiento de mi implementación, en especifico la parte dedicada a los controladores PI

\newpage
\section{Validación de los Controladores PI}
En esta validación se quiere ver si los controladores PI de velocidad y corriente son capaces de mantener sus set point. estas pruebas se realizaron de forma estática, aplicando un poco de carga sobre el motor y tomando una captura de datos durante esto.

\subsection{Validación del controlar de velocidad}
Para la validación se aplico un set point de 116.8 RPM con uno de los potenciómetros.//mejorar este texto

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{ruta/del/primer_grafico.png}
	\caption{Velocidad medida por el encoder y setpoint de velocidad.}
	\label{velocidad_encoder}
\end{figure}
\FloatBarrier

//texto

\subsection{Validación del controlar de corriente}

//texto

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{ruta/del/segundo_grafico.png}
	\caption{Corrientes medidas en el plano $dq$.}
	\label{corrientes_dq}
\end{figure}
\FloatBarrier

//texto

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{ruta/del/tercer_grafico.png}
	\caption{Voltajes en el plano $dq$.}
	\label{voltajes_dq}
\end{figure}
\FloatBarrier

//texto

puedes escribir la validación de mi controlador? el texto debe ser breve, no mas de un párrafo y siempre se debe mantener un lenguaje en tercera persona